<section>
    <div bs-panel-content>
        <p ng-show="ctrl.previousRules">Restore previous {{ctrl.previousRules.length}} rules? <button ng-click="ctrl.restorePreviousRules()" bs-button="subtle-alt size-small">Restore</button></p>
        <p>
            <button id="create-rewrite-rule" bs-button="size-small subtle-alt icon-left" ng-click="ctrl.showInputs();">
                <icon icon="circle-plus" ng-show="!ctrl.state.adding"></icon>
                <icon icon="bin" ng-show="ctrl.state.adding"></icon>
                {{ctrl.buttonText}}
            </button>
        </p>
        <div ng-show="ctrl.state.adding">
            <form name="rewriteForm">

            <div bs-heading-bar>
                <label for="rewrite-match" bs-input-label="">Match</label>
                <div bs-button-group="">
                    <button bs-button="size-small subtle-alt" ng-disabled="ctrl.inputs.match.type === 'string'" ng-click="ctrl.setMatchType('string')">
                        String
                    </button>
                    <button bs-button="size-small subtle-alt" ng-click="ctrl.setMatchType('regex')" ng-disabled="ctrl.inputs.match.type === 'regex'">
                        Regex
                    </button>
                </div>
            </div>
            <div bs-heading-bar ng-show="ctrl.inputs.match.type === 'regex'">
                <label for="rewrite-match" bs-input-label="">Flags</label>
                <div bs-button-group="">
                    <div bs-input="text">
                        <input type="text" placeholder="eg: gi" ng-model="ctrl.inputs.match.flags"/>
                    </div>
                </div>
            </div>
            <div bs-textarea-input>
                <span bs-tag bs-error="offset" ng-show="ctrl.inputs.match.type === 'regex' && !rewriteForm['rewriteMatch'].$valid">Invalid <span>Regex</span></span>
                <textarea
                        id="rewrite-match"
                        cols="30"
                        rows="5"
                        bs-code-input
                        name="rewriteMatch"
                        ng-model="ctrl.inputs.match.value"
                        valid-regex="ctrl.inputs.match.type"
                        flags="ctrl.inputs.match.flags"
                        ng-required="1"
                        ng-minlength="1"
                        placeholder="Eg: 'skin/core.css' or /skin.core.css/g"></textarea>
                <br/>
            </div>
            <div bs-heading-bar="">
                <label for="rewrite-replace" bs-input-label="">Replace</label>
                <div bs-button-group="">
                    <button bs-button="size-small subtle-alt" ng-disabled="ctrl.inputs.replace.type === 'string'" ng-click="ctrl.setReplaceType('string')">
                        String
                    </button>
                    <button bs-button="size-small subtle-alt" ng-click="ctrl.setReplaceType('function')" ng-disabled="ctrl.inputs.replace.type === 'function'">
                        Function
                    </button>
                </div>
            </div>
            <div bs-textarea-input>
                <span bs-tag bs-error="offset" ng-show="ctrl.inputs.replace.type === 'function' && !rewriteForm['replace-input'].$valid">Invalid <span>Function</span><span>Body</span></span>
                <textarea
                        id="rewrite-replace"
                        cols="30"
                        rows="5"
                        name="replace-input"
                        bs-code-input
                        ng-model="ctrl.inputs.replace.value"
                        valid-fn="ctrl.inputs.replace.type"
                        placeholder="Eg: 'skin/core.css' or /skin.core.css/g"></textarea>
                <br/>
            </div>
            <div ng-class="[ctrl.state.classname]" bs-state-wrapper>
                <div bs-button-group="">
                <button id="save-rule" bs-button="size-small subtle-alt icon-left" ng-click="ctrl.saveRule()" ng-disabled="ctrl.state.waiting">
                    <svg bs-svg-icon class="ng-isolate-scope"><use xlink:href="#svg-circle-ok"></use></svg>
                    Save
                </button>
                <button id="save-rule2" bs-button="size-small subtle-alt icon-left" ng-click="ctrl.saveRule('reload')" ng-disabled="ctrl.state.waiting">
                    <svg bs-svg-icon class="ng-isolate-scope"><use xlink:href="#svg-circle-ok"></use></svg>
                    Save & Reload
                </button>
                    </div>
                <div bs-state-icons>
                    <icon icon="circle-ok" bs-state="success inline"></icon>
                    <icon icon="circle-minus" bs-state="waiting inline" bs-anim="spin"></icon>
                </div>
            </div>
            </form>
        </div>
    </div>
    <div bs-panel-content ng-show="ctrl.rules.length">
        <div ng-repeat="(key, rule) in ctrl.rules track by rule.id">
            <ul bs-list="bordered inline-controls leading-controls" bs-flush="bottom">
                <li>
                    <p>Rule <b>{{$index + 1}} <span style="color: #e1e1e1; margin-left: 10px">id: {{rule.id.slice(0, 10)}}</span></b></p>
                    <div bs-button-group>
                        <button bs-button="subtle-alt icon" ng-click="ctrl.editRule(rule)">
                            <icon icon="pencil"></icon>
                        </button>
                        <button bs-button="subtle-alt icon" ng-click="ctrl.pauseRule('pause', rule)"
                                class="ng-click-active">
                            <icon icon="circle-pause" ng-show="rule.active"></icon>
                            <icon icon="circle-play" ng-show="!rule.active"></icon>
                        </button>
                        <button bs-button="subtle-alt icon" ng-click="ctrl.removeRule('remove', rule)">
                            <icon icon="bin"></icon>
                        </button>
                    </div>
                </li>
                <li bs-input="text">
                    <span bs-tag>Match <span>{{rule.matchType}}</span></span>
                    <span bs-tag="offset" ng-show="rule.matchFlags">Flags <span>{{rule.matchFlags}}</span></span>
                    <p bs-text="mono">{{rule.matchInput}}</p>
                </li>
                <li>
                    <span bs-tag>Replace<span>{{rule.replaceType}}</span></span>
                    <p bs-text="mono">{{rule.replaceInput}}</p>
                </li>
            </ul>
        </div>
    </div>
</section>
